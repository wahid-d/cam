@page "/addstudent"
@using cam.Models
@using cam.Services
@inject NavigationManager NavigationManager
@inject IStudentService studentRepo
@inject IClassService classRepo

<section class="page-body">
    <div class="form-wrapper card">
        <EditForm Model="@student" OnValidSubmit="SaveStudent">
            <DataAnnotationsValidator />

            <h2 class="title-1">Register a student</h2>

            <label class="label-1" for="ename">영어 이름<small>*</small></label>
            <input type="text" id="ename" required @bind="student.EnglishName" placeholder="Sarah">

            <label class="label-1" for="kname">Korean name<small>*</small></label>
            <input type="text" id="kname" required @bind="student.KoreanName">

            <label class="label-1" for="school">School<small>*</small></label>
            <input type="text" id="school" required @bind="student.SchoolName">

            <label class="label-1" for="phone">phone number<small>*</small></label>
            <input type="tel" id="phone" pattern="[0-9]{3}[0-9]{4}[0-9]{4}" required @bind="student.Phone">

            <label class="label-1" for="address">address</label>
            <input type="address" id="address" @bind="student.Address">

            <label class="label-1" for="level">level<small>*</small></label>
            <select type="text" id="level" required @bind="student.Level">
                <option >Select ...</option>
                @foreach (var level in levels)
                {
                    <option value=@level>@level</option>
                }
            </select>

            <label class="label-1" for="class">Select class<small>*</small></label>
            <select type="text" id="class" required @bind="student.ClassId">
                <option >Select ...</option>
                @foreach (var c in classes)
                {
                    <option value=@c.Id>@c.Name</option>
                }
            </select>
            <button type="submit" class="submit-btn">
                Submit
            </button>
        </EditForm>
    </div>
</section>

@code{
    List<string> levels = new List<string>(){"Select ...", "Primary 1", "Primary 2", "Primary 3", "Primary 4", "Primary 5", "Primary 6"};
    Student student = new Student();

    List<Class> classes = new List<Class>();
    
    protected override async Task OnInitializedAsync()
    {
        classes = await classRepo.Get();
        StateHasChanged();
    }
    private void SaveStudent()
    {
        Save(student);
    }

    private async void Save(Student student)
    {
        await studentRepo.Insert(student);
        NavigationManager.NavigateTo("/students", false);
    }

}